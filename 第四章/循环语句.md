# 循环语句

我们已经实现了条件语句，那么循环语句其实也很好实现了。

## Z的循环语句

问题在于，循环语句有好几种：

- while：当条件为真时，执行循环体
- do-while：先执行循环体，再判断条件
- for(;;)：先执行初始化语句，再判断条件，再执行循环体，再执行步进语句
- for i in arr: 语法糖，等价于for循环
- loop：无限循环

当然，这些不同的循环，只是初始条件、结束条件的判断方式的区别而已，实际上是互通的。

比如`while`语句和`for`语句，其实是等价的：

```c
int i = 0;
while (i < 10) {
    printf("%d\n", i);
    i = i + 1;
}
```

和下面的for循环是等价的：

```c
for (int i = 0; i < 10; i = i + 1) {
    printf("%d\n", i);
}
```

非要说这两句有什么区别的话，也就是`i`的作用域不同而已。

Go语言把这几种循环全都统一到一个`for`语句来实现，我觉得很值得借鉴：

```go
// 普通for(;;)循环
for i := 0; i < 10; i++ {
    fmt.Println(i)
}

// while循环
i := 0
for i < 10 {
    fmt.Println(i)
    i++
}

// 无限循环
for {
    fmt.Println("loop forever")
}

// do-while循环
i := 0
for {
    fmt.Println(i)
    i++
    if i >= 10 {
        break
    }
}

// for i in arr
for i, v := range arr {
    fmt.Println(i, v)
}
```

Z语言的循环也学习这种“用一套语法实现多种逻辑”的思路，但具体设计不同：

```z
// 循环固定次数：
for i in 0..10 {
    print(i)
}

// 遍历一个容器
for i, v in arr {
    print(i, v)
}

// while循环
mut i = 0;
for i < 10 {
    print(i)
    i = i + 1
}

// 注意：和C语言不一样，这里的`let c = getchar()`每次循环都会调用
for let c = getchar(); c != EOF {
    print("got char: $c")
}

// 无限循环
for {
    print("loop forever")
}

// break
for {
    print("loop forever")
    print("input a char:")
    let c = getchar()
    if c == 'q' { break }
    print("got char: $d")
}

// continue

for {
    print("input a char:")
    let c = getchar()
    if c == 'q' { break }
    if c == ' ' { continue }
    print("got char: $d")
}
```

注意，Z里没有C语言的传统三段式`for(;;)`循环，这是因为Z更推崇不用`mut`的方式。
当然，要模拟C语言的`for(;;)`循环，可以用上面的`while`形式。

当然，这些不同的形式都还是构思，暂时没法全实现。本节我也只打算实现其中一个，探索下可能性而已。

那么选哪一个呢？现阶段最简单实现的还是简单的`while`形式。
所以我选择这个。

不过，考虑到典型的`while`是需要一个`mut`变量配合的，所以本节我们还要先实现`mut`。

在编译器里实现完`mut`和赋值功能之后，写完了所有的说明，我发现不如把这个话题单独列为一节。
于是就挪到[变量与赋值](./变量与赋值.md)那一节去了。

接下来我们继续实现`for`循环的话题。
首先是前端。

## 前端解析

要实现`for`循环，前端要添加如下支持：

- `for`关键字
- `in`关键字（暂时不需要，因为我们没选择实现这个形式）
- `..`运算符（暂时不需要，因为我们没选择实现这个形式）
- `break`关键字
- `continue`关键字