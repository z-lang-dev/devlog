# 整数

要想做个计算器，首先要有数字。

而Z语言现在还么有数字。

所以，我们先来实现一类最简单的数字：整数。


## 整数的表示

整数是什么？

生活中，我们所说的整数，就是可以一个个数出来的数。从1开始数，一直数下去的每一个数都是整数。
这个意思实际上是我们数学中说说的自然数。

数学上，整数是指正整数、0和负整数的集合。而正整数就是自然数；0是表示“没有”的数；而负整数-N就是比0小N的数。
 
整数的个数是无穷的。

但计算机的存储是有限的。以有限的存储来表达无穷的整数，显然不可能。
所以计算机能存储的整数，实际上只是真正整数的很小一部分。严格的说，是无穷小的一部分。

计算机是用0和1（实际上是晶体管的导通和截断，即高电平和低电平）来表示数字的。
0和1只有两个数字，因此叫做二进制。

我们平时用十个指头数数，数到10之后指头不够用了，就想出了进位的办法，把双手能数出来最大的数，作为一个更“高阶”的单位，也就是“十位数”。这样，就可以继续数下去了。
而十这个数字也就成了我们最常见的数位制度的基数：十进制。

计算机的基本存储单位叫一个比特（bit），只能存放0和1，因此要数到2时，发现指头不够用了，怎么进位呢？
再找一个比特帮忙，用两个比特位来表示：00、01、10、11。这样就能从0数到3了。00表示0，01表示1，10表示2，11表示3。

也就是说：

- 2个比特能表示的数最多有4个。也就是2的2次方。在想多数，又得进一位，借来一个存储单位。
- 3个比特能表示的数最多有8个。也就是2^3个。分别是：000、001、010、011、100、101、110、111。
- 4个比特能表示的数最多有2^4个，从0000到1111。

依次类推，我们可以画个表：

画个表：

| 存储单位 | 能表示的个数 | 最大整数 | 二进制表示 |
| --- | --- | --- | --- |
| 1 | 2^1 | 1 | 1 |
| 2 | 2^2 | 3 | 11 |
| 3 | 2^3 | 7 | 111 |
| 4 | 2^4 | 15 | 1111 |
| 5 | 2^5 | 31 | 1_1111 |
| 6 | 2^6 | 63 | 11_1111 |
| 7 | 2^7 | 127 | 111_1111 |
| 8 | 2^8 | 255 | 1111_1111 |
| 9 | 2^9 | 511 | 1_1111_1111 |
| 10 | 2^10 | 1023 | 11_1111_1111 |
| 11 | 2^11 | 2047 | 111_1111_1111 |
| 12 | 2^12 | 4095 | 1111_1111_1111 |
| 13 | 2^13 | 8191 | 1_1111_1111_1111 |
| 14 | 2^14 | 16383 | 11_1111_1111_1111 |
| 15 | 2^15 | 32767 | 111_1111_1111_1111 |
| 16 | 2^16 | 65535 | 1111_1111_1111_1111 |
| 32 | 2^32 | 4294967295 | 1111_1111_1111_1111_1111_1111_1111_1111 |
| 64 | 2^64 | 18446744073709551616 | 1111_1111_1111_1111_1111_1111_1111_1111_1111_1111_1111_1111_1111_1111_1111_1111 | 

注意，二进制要表示比较大的数时，书写太长了，很难分清楚位数，因此我给每4位加了一个下划线，方便阅读。

这里面：

- 一个存储单位是比特，可以表示0和1；
- 8个比特组合起来称为一个**字节**（byte），可以表示2^8个数，也就是256个。
- 16个比特组合起来称为一个**字**（word），可以表示2^16个数，也就是65536个。在C语言里，这个单位也叫`short`即“短整数”。现在这个单位已经很少用了。
- 32个比特组合起来称为一个**双字**（double word），可以表示2^32个数，也就是4294967296个。在C语言里，这个单位叫`int`，即“整数”。
- 64个比特组合起来称为一个**四字**（quad word），可以表示2^64个数，也就是18446744073709551616个。在C语言里，这个单位叫`long`，即“长整数”。

这些位数有什么用呢？一台机器，在计算时，CPU访问到的最快的存储器是寄存器。
而我们把寄存器进行整数和寻址（这个以后介绍指针会讲）计算时所采用的位数叫做整个机器的位数，如16位机、32位机，以及现在主流的64位机。
有些年长的同学可能还学过8位单片机（比如著名的51单片机），但现在已经很少用了。现在学习嵌入式，一般也从STM32学起了。

我们可以从“字”的名称和C语言的“int”定义里看到一种历史的断层。
显然，“字”、“双字”、“四字”这种叫法兴盛的时代，16位机器是主流，32位机器还很少见。
而C语言兴盛的时代，32位机已经逐渐成为主流，因此默认的`int`（也就是Integer，整数）变成了32位。

而现在这个时代，64位机器和系统都已经称为主流，所以Z语言的整数，即`int`型，默认是64位。

我们本章讨论的整数`int`，都指64位数。除非在进行转译C的讨论时，会说“C的int型”。

对于常见整数，Z语言命名如下：

- 1位：比特（bit）
- 8位：字节（byte）
- 16位：短整数（short）
- 32位：字符（char）
- 64位：整数（int）
- 128位：长整数（long）

Z语言还采用了另一套更明确的命名方式，在与其他语言进行交互时会很方便：

- 1位：i1
- 8位：i8
- 16位：i16
- 32位：i32
- 64位：i64
- 128位：i128

出于简单起见，我们当前只实现64位整数。

## 语法树

到现在为止，Z语言只有一种表达式：`print`。
数据类型也只有字符串，而且还是没有完整实现的字符串。
例如在汇编中，我们直接把字符串存放在了常量区，这些常量是没法改变的，也就没法实现字符串的变化与拼接。除了打印出来，用处并不大。

但本章我们要认真地实现第一种类型是整数。字符串的复杂度远高于整数，至少需要数组的支持，所以放到后面的章节来实现。

我们本章实现的最简单的示例如下：

```z
print(1)
```

它和Hello World程序的主要区别就是`"Hello, world!"`是一个双引号括起来的字符串，而`1`是一个数字。
我们需要在解析代码时，识别出`print(...)`括号里的内容，再根据引号来判断到底是整数还是字符串。

由于本章我们仍然只需要`print`这一个函数，Z语言暂时不需要修改对函数的解析。

我们来看看之前的语法树：

```c
```