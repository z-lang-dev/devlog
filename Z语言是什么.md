# Z语言是什么？

Z语言不是一门通用编程语言，而是一门面向**学习**与**探索**的语言。
它是我用来学习编译器及相关技术的载体，也是我用来探索编程语言设计的工具。

我一向都坚持这样的理念：“学习的最好成果是创造出属于自己的作品”。
Z语言就是这样一份作品。

而《Z语言炼成记》这本书，就是这份作品的注解。

我的学习目标其实很简单，就是想搞清楚“这玩意儿到底是怎么实现的？”。对于任何代码都是如此。

- 我很想了解编译器技术，因为任何程序都是通过编译器来构建的。
- 我对下一代互联网的理念（即大家所说的元宇宙或Web3.0）很感兴趣，那就需要了解图形引擎，那么就得了解C/C++。
- 我很想了解Stable Diffusion是如何做出来的，那么了解Python就很有必要。
- 我想开发自己的网站或应用，那么前端技术是绕不开的。

某一天个我突发奇想：“要是能用自己的语言来完成这些事情，那该多么好？”

Z语言就是用来学习和探索这些计算机领域的载体。

## Z语言的特色

既然是自己的作品，那么Z语言应当有独属于我自己的特色。

Z语言的特色用一句话说就是：“兼收并蓄，动静皆宜”。

### 兼收并蓄

所谓“兼收并蓄”，就是“什么都能做，但只能做一点儿”。


我对Z语言最终期望是做啥事儿都可以用它来完成，包括前端、中端、后端，跨越各种生态、平台、设备。
这种期望显然是不可能实现的，所以我只能借助其他生态来完成：

- 前端的东西交给JavaScript就好，没办法，前端里JS是唯一真神。
- 后端的东西交给C吧，毕竟C才是真正的底层语言，我甚至把它当做跨平台汇编来看。
- 其他花里胡哨的东西，就交给Python吧。尤其是AI。

总的来说，“学好数理化，走遍天下都不怕”，而Javascript、C和Python就是Z语言的“数理化”。

那这种兼收并蓄怎么实现呢？我的办法是设计一套通用的AST语法树，就叫zast。
Z语言解析成zast之后，既可以直接动态执行（利用`zi`解释器），也可以翻译成C、JavaScript和Python（利用`zc`编译器）。
另外，出于学习和探索的目的，我还会做一个传统的编译器，即把zast直接编译成x86-64汇编。

这样一来，Z语言需要实现如下几个东西：

- Z前端，将Z语言源码解析成zast。
- zi解释器（Z Interpreter），动态执行zast。
- zc编译器（Z Compiler），将zast编译成x86-64汇编。
- zt转译器（Z Transpiler），将zast转译成其他语言的AST。
    - zc->C转译器，将zast转译成C。
    - zc->JS转译器，将zast转译成JavaScript。
    - zc->PY转译器，将zast转译成Python。

当然，为了方便起见，我把所有的功能都统一到一个命令`z`里了。

### 动静皆宜

我一向不喜欢站队，所以涉及到编程语言里最大的一个争论“动态还是静态”时，我的答案就是“动静皆宜”。

动态语言灵活善变，更适合探索式地开发，因此在前端和科研界大获成功。
静态语言急速稳固，更适合工业化地运行，因此在后端和产业界占据主导。

Z语言既然是用来“学习”的编程语言，那么这两个方向都不能抛弃。

恰好我想到了一个办法，能让Z语言比较优雅地兼容动态和静态。当然，这个办法借鉴了C#等很多编程语言的实践。

这个办法我称之为“面向场景编程”（Scenario-Oriented Programming，SOP）。
等开发到相应模块时，我会详细介绍。现在它只是一个构思，还需要更多的学习和探索。

总之，Z语言在两个层面上做到“动静皆宜”：

- 既支持动态类型，也支持静态类型。
- 既支持动态解释，也支持静态编译。

我们既可以把Z语言当做Python来用，甚至未来可以支持类似JupyterNotebook这样的交互方式；
也可以把它翻译成C，再编译成本地可执行文件。

## Z语言长什么样？

总体而言，Z的语法风格源自于C。大概长这样：

```c
// 导入标准库，用use关键字。
use io.[print, open, W]

// 常量定义用const关键字。
// 浮点数的字面值需要加上f后缀。
const PI = 3.1415926f


// 函数定义和Go比较像。函数的关键字是`fn`。Z语言里函数默认是纯函数，即不能产生副作用。
fn add(a int, b int) int {
  // 代码块的最后一个语句即是返回值
  a + b
}

// 加上@mut标注，则函数可以产生副作用
@mut
fn writeFile(name str, s str) bool {
  let f = open(name, W) 
  on(exit) {
    f.close()
    return false
  }
  f.write(s)
  return true
}

// 加上@var标注，则函数可以不指定参数和返回值类型，这样的函数和JS与Python的函数类似。
@var
fn alert(message) {
  message = "Alert!! $message"
  print(message)
}

// main函数是特殊的函数，它是程序的入口。不需要指定@mut或@var标注。
fn main {
  // 函数调用与C一致。
  print("Hello, world!") // 语句结尾不需要';'。

  // Z语言支持嵌入字符串。这里PI值被直接嵌入到字符串里了。
  print("Here is pi: ${PI}")

  // let标量，类似于C的变量，但它的值是不可变的。
  let a int = 10 // 可以在变量名称后直接指定类型，如果不指定，编译器会自动推导。
  a = 12 // 错误！a是不可变的量。

  // mut变量。这个相当于C语言里的普通变量。
  mut b = 5 // 支持基本的类型推导。
  b = b * 2 // 正确！b是可变量。
  b = "Z语言" // 错误！不能改变变量的类型。

  // var幻量。这个相当于JavaScript里的var变量，不但值可以变，类型也可以变。
  var c = 5
  c = "Z语言" // 正确！c是幻量，可以从整数类型变成字符串。

  print("a+b is $add(a, b)")
}
```